jQuery(document).ready(function(t){"use strict";var e=".global-condition-select",i=".archives-condition-select",n=".singles-condition-select",a=".tx-condition-input-ids",s=t(".tx-condition-popup-wrap"),o=t(".nav-tab-active").attr("data-title");function l(){var e=o.replace(/\W+/g,"-").toLowerCase();return t(".template-filters").length>0&&(e=(e=t(".template-filters .active-filter").last().attr("data-class")).substring(0,e.length-1)),e}function c(){var e="my_templates"===l()?"elementor_library":"tx_templates",i=t(".tx-user-template-title").val(),n="user-"+l()+"-"+i.replace(/\W+/g,"-").toLowerCase();"elementor_library"===e&&(n=l()+"-"+i.replace(/\W+/g,"-").toLowerCase());var a={action:"tx_create_template",nonce:TXThemeBuilder.nonce,user_template_library:e,user_template_title:i,user_template_slug:n,user_template_type:l()};t.post(ajaxurl,a,function(e){t(".tx-user-template-popup-wrap").fadeOut(),setTimeout(function(){var i,a,c,p,f,h=e.substring(0,e.length-1);if("my_templates"===o.replace(/\W+/g,"-").toLowerCase()){window.location.href="post.php?post="+h+"&action=elementor";return}t(".tx-save-conditions").attr("data-slug",n).attr("data-id",h),l(),a=t(".tx-user-template-title").val(),c=n,p=h,f="",f+="<li>",f+='<h3 class="tx-title">'+a+"</h3>",f+='<div class="tx-action-buttons">',f+='<span class="tx-template-conditions button-primary" data-slug="'+c+'">Manage Conditions</span>',f+='<a href="post.php?post='+p+'&action=elementor" class="tx-edit-template button-primary">Edit Template</a>',f+='<span class="tx-delete-template button-primary" data-slug="'+c+'" data-warning="Are you sure you want to delete this template?"><span class="dashicons dashicons-no-alt"></span></span>',f+="</div>",f+="</li>",t(".tx-my-templates-list.tx-"+l()+"-templates-list").prepend(f),t(".tx-empty-templates-message").length&&t(".tx-empty-templates-message").remove(),d(),r(),t(".tx-no-templates").length&&t(".tx-no-templates").hide(),u(n),s.addClass("editor-redirect")},500)})}function r(){t(".tx-delete-template").on("click",function(){var e=t(this);if(confirm(e.data("warning"))){var i="my_templates"===l()?"elementor_library":"tx_templates",n=e.attr("data-slug"),a={nonce:e.attr("data-nonce"),action:"tx_delete_template",template_slug:n,template_library:i};if(t.post(ajaxurl,a,function(t){e.closest("li").remove()}),t.post(ajaxurl,a,function(e){setTimeout(function(){0===t(".tx-my-templates-list li").length&&t(".tx-my-templates-list").append('<li class="tx-no-templates">You don\'t have any templates yet!</li>')},500)}),"my_templates"!==l()){var s=JSON.parse(t("#tx_"+o+"_conditions").val());delete s[n],t("#tx_"+o+"_conditions").val(JSON.stringify(s));var a={action:"tx_save_template_conditions",nonce:TXThemeBuilder.nonce};a["tx_"+o+"_conditions"]=JSON.stringify(s)}}})}function d(){t(".tx-template-conditions").on("click",function(){var e=t(this).attr("data-slug");t(".tx-save-conditions").attr("data-slug",e),u(e)})}function p(){t(".tx-conditions-wrap").append('<div class="tx-conditions">'+t(".tx-conditions-sample").html()+"</div>"),t(".tx-conditions").removeClass("tx-tab-"+o).addClass("tx-tab-"+o);var e=t(".tx-conditions").last();e.find("select").not(":first-child").hide(),e.hide().fadeIn();var i=t(".template-filters .active-filter").attr("data-class");"blog-posts"===i||"custom-posts"===i?(e.find(".singles-condition-select").children(":nth-child(1),:nth-child(2),:nth-child(3)").remove(),e.find(".tx-condition-input-ids").val("all").show()):"woocommerce-products"===i?(e.find(".singles-condition-select").children().filter(function(){return"product"!==t(this).val()}).remove(),e.find(".tx-condition-input-ids").val("all").show()):"404-pages"===i?e.find(".singles-condition-select").children().filter(function(){return"page_404"!==t(this).val()}).remove():"blog-archives"===i||"custom-archives"===i?e.find(".archives-condition-select").children().filter(function(){return"products"==t(this).val()||"product_cat"==t(this).val()||"product_tag"==t(this).val()}).remove():"woocommerce-archives"===i&&e.find(".archives-condition-select").children().filter(function(){return"products"!==t(this).val()&&"product_cat"!==t(this).val()&&"product_tag"!==t(this).val()}).remove()}function u(l){!function i(n){var s=t("#tx_"+o+"_conditions").val();if(s=""!==s?JSON.parse(s):{},t(".tx-conditions").remove(),void 0!=s[n]&&s[n].length>0){for(var l=0;l<s[n].length;l++)p(),t(".tx-conditions").find("select").hide();t(".tx-conditions").length&&t(".tx-conditions").each(function(i){for(var o=s[n][i].split("/"),l=0;l<o.length;l++)0===l?(t(this).find(e).val(o[l]).trigger("change"),t(this).find("."+o[l]+"s-condition-select").show()):1===l?(o[l-1]="product_archive"===o[l-1]?"archive":o[l-1],t(this).find("."+o[l-1]+"s-condition-select").val(o[l]).trigger("change")):2===l&&t(this).find(a).val(o[l]).trigger("keyup").show()})}}(l),h(),m(),f();var c=t(".tx-conditions");"single"===o||"product_single"===o?c.find(n).show():"archive"===o||"product_archive"===o?c.find(i).show():c.find(e).show(),t(".tx-conditions-wrap").addClass(t(".template-filters .active-filter").attr("data-class")),s.fadeIn()}function f(){t(".tx-delete-template-conditions").on("click",function(){var e=t(this).parent(),i=t("#tx_"+o+"_conditions").val();i=""!==i?JSON.parse(i):{},t("#tx_"+o+"_conditions").val(JSON.stringify(v(i,x(e)))),e.fadeOut(500,function(){t(this).remove()})})}function h(){t(e).on("change",function(){var e=t(this).parent();e.find(i).hide(),e.find(n).hide(),e.find(a).hide(),e.find("."+t(this).val()+"s-condition-select").show()})}function m(){t(".archives-condition-select, .singles-condition-select").on("change",function(){var e=t(this).parent(),i=t("option:selected",this);i.hasClass("custom-ids")||i.hasClass("custom-type-ids")?e.find(a).val("all").trigger("keyup").show():e.find(a).hide()})}function v(e,i){var n=[];for(var a in t(".tx-template-conditions").each(function(){n.push(t(this).attr("data-slug"))}),e)if(e.hasOwnProperty(a)){for(var s=0;s<e[a].length;s++)i==e[a][s]&&"popup"!==l()&&e[a].splice(s,1);-1===n.indexOf(a)&&delete e[a]}return e}function x(t){var s="",l="none"!==t.find(e).css("display")?t.find(e).val():o,c=t.find(i).val(),r=t.find(n).val(),d=t.find(a);return"archive"===l||"product_archive"===l?"none"!==d.css("display")?l+"/"+c+"/"+d.val():l+"/"+c:"single"===l||"product_single"===l?"none"!==d.css("display")?l+"/"+r+"/"+d.val():l+"/"+r:"global"}if(o=(o=o.trim().toLowerCase()).replace(" ","_"),t(".tx-user-template").on("click",function(){if(t(this).find("div").length){alert("Please Install/Activate WooCommerce!");return}t(".tx-user-template-title").val(""),t(".tx-user-template-popup-wrap").fadeIn()}),t(".tx-user-template-popup").find(".close-popup").on("click",function(){t(".tx-user-template-popup-wrap").fadeOut()}),t(".tx-create-template").on("click",function(){""===t(".tx-user-template-title").val()?(t(".tx-user-template-title").css("border-color","red"),t(".tx-fill-out-the-title").length<1&&(t(".tx-create-template").before('<p class="tx-fill-out-the-title"><em>Please fill the Title field.</em></p>'),t(".tx-fill-out-the-title").css("margin-top","4px"),t(".tx-fill-out-the-title em").css({color:"#7f8b96","font-size":"smaller"}))):(t(".tx-user-template-title").removeAttr("style"),t(".tx-create-template + p").remove(),c())}),t(".tx-user-template-title").keypress(function(t){13==t.which&&(t.preventDefault(),c())}),r(),d(),s.find(".close-popup").on("click",function(){s.fadeOut()}),t(".tx-add-conditions").on("click",function(){p(),t(".tx-conditions").last().find("input").hide(),f(),h(),m()}),t(".tx-save-conditions").on("click",function(){var e,i,n=t(this).attr("data-slug"),a=t(this).attr("data-id"),l=(e=n,(i=""===(i=t("#tx_"+o+"_conditions").val())||"[]"===i?{}:JSON.parse(i))[e]=[],t(".tx-conditions").each(function(){var n=x(t(this));(i=v(i,n))[e].push(n)}),i);t("#tx_"+o+"_conditions").val(JSON.stringify(l));var c={action:"tx_save_template_conditions",nonce:TXThemeBuilder.nonce,template:n};c["tx_"+o+"_conditions"]=JSON.stringify(l),t.post(ajaxurl,c,function(e){for(var i in s.fadeOut(),l)l[i]&&0!==l[i].length?t('.tx-delete-template[data-slug="'+i+'"]').closest("li").addClass("tx-active-conditions-template"):t('.tx-delete-template[data-slug="'+i+'"]').closest("li").removeClass("tx-active-conditions-template");s.hasClass("editor-redirect")&&(window.location.href="post.php?post="+a+"&action=elementor")})}),t("body").hasClass("toplevel_page_tx-theme-builder")&&"my_templates"!==o){var g=t("#tx_"+o+"_conditions").val(),g=""===g||"[]"===g?{}:JSON.parse(g);for(var y in g)t('.tx-delete-template[data-slug="'+y+'"]').closest("li").addClass("tx-active-conditions-template")}t(".tx-settings-page form").submit(function(){var e=t(this).serialize();return t.post("options.php",e).error(function(){}).success(function(){t(".tx-settings-saved").stop().fadeIn(500).delay(1e3).fadeOut(1e3)}),!1}),t(".tx-element").find("input").on("change",function(){t(".tx-settings-page form").submit()})});